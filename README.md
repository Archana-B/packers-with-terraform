# PACKER WITH TERRAFORM

This is a simple example to build AMI images with Packers and spin an EC2 instance with the generated AMI using Terraform

## Export your access key and secret key as environment variables:

```
export AWS_ACCESS_KEY_ID={{ YOUR_ACCESS_KEY }}
export AWS_SECRET_ACCESS_KEY={{ YOUR_SECRET_KEY }}
```

# To build AMI Image using packer:

```
packer validate ubuntu-with-docker.json
```
 which validates the config json

 ```
 packer build ubuntu-with-docker.json
 ```

 which will create the AMI image in AWS


 # To provision EC2 instance with terraform scripts:

 1. Copy the AMI ID that was generated by Packer
 2. Create a Key pair in AWS Console (https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-key-pairs.html)

## Export them as variables

 ```
 TF_VAR_ACCESS_KEY={{ YOUR_ACCESS_KEY }} TF_VAR_SECRET_KEY= {{ YOUR_SECRET_KEY }} TF_VAR_AMI_ID={{ YOUR_AMI_ID }} TF_VAR_KEY_NAME={{ YOUR_KEY_NAME }} terraform plan
 ```

 which displays the changes that will be done when you do terraform apply

  ```
 TF_VAR_ACCESS_KEY={{ YOUR_ACCESS_KEY }} TF_VAR_SECRET_KEY= {{ YOUR_SECRET_KEY }} TF_VAR_AMI_ID={{ YOUR_AMI_ID }} TF_VAR_KEY_NAME={{ YOUR_KEY_NAME }} terraform apply
 ```

which provisions the required infrastructure (in our case EC2 instance will be created)


  ```
 TF_VAR_ACCESS_KEY={{ YOUR_ACCESS_KEY }} TF_VAR_SECRET_KEY= {{ YOUR_SECRET_KEY }} TF_VAR_AMI_ID={{ YOUR_AMI_ID }} TF_VAR_KEY_NAME={{ YOUR_KEY_NAME }} terraform destroy
 ```

to delete all the resources that was created by terraform